(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/store/pay"],{"2fb2":function(t,o,n){"use strict";n.r(o);var e=n("3ac8"),s=n("cdbc");for(var i in s)"default"!==i&&function(t){n.d(o,t,function(){return s[t]})}(i);n("b31d");var a=n("2877"),r=Object(a["a"])(s["default"],e["a"],e["b"],!1,null,null,null);o["default"]=r.exports},"3ac8":function(t,o,n){"use strict";var e=function(){var t=this,o=t.$createElement;t._self._c},s=[];n.d(o,"a",function(){return e}),n.d(o,"b",function(){return s})},a18d:function(t,o,n){"use strict";(function(t){n("1857"),n("921b");e(n("66fd"));var o=e(n("2fb2"));function e(t){return t&&t.__esModule?t:{default:t}}t(o.default)}).call(this,n("543d")["createPage"])},b31d:function(t,o,n){"use strict";var e=n("e8ea"),s=n.n(e);s.a},c817:function(t,o,n){"use strict";(function(t){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var e=i(n("a34a")),s=n("2f62");function i(t){return t&&t.__esModule?t:{default:t}}function a(t,o,n,e,s,i,a){try{var r=t[i](a),c=r.value}catch(u){return void n(u)}r.done?o(c):Promise.resolve(c).then(e,s)}function r(t){return function(){var o=this,n=arguments;return new Promise(function(e,s){var i=t.apply(o,n);function r(t){a(i,e,s,r,c,"next",t)}function c(t){a(i,e,s,r,c,"throw",t)}r(void 0)})}}var c={data:function(){return{inmoney:"",discount_money:0,step:0,store_name:"",store_avatar:"",store_id:0,payType:3,paycode:"pdpay",memberInfo:{},maskState:0,couponList:[],selectCouponId:0,selectCouponTxt:"选择优惠券",logining:!1,password:"",mask:!1,passwordArray:[],pwdnum:0,bott:"",pasList:["","","","","",""],numbr:[1,2,3,4,5,6,7,8,9]}},computed:(0,s.mapState)(["hasLogin","userInfo"]),onLoad:function(t){this.store_id=t.store_id,this.loadData(t)},methods:{loadData:function(){var o=r(e.default.mark(function o(n){var s;return e.default.wrap(function(o){while(1)switch(o.prev=o.next){case 0:s=this,console.log("===userInfo==="+this.hasLogin),console.log(this.userInfo),console.log(this.userInfo.token),this.hasLogin?this.$Request.post("member_buy/store_info",{store_id:s.store_id}).then(function(o){200==o.code?(console.log(o),s.store_name=o.datas.store_name,s.store_avatar=o.datas.store_avatar):t.showToast({icon:"none",title:o.datas.error,duration:2e3})}):t.navigateTo({url:"/pages/member/login"});case 5:case"end":return o.stop()}},o,this)}));function n(t){return o.apply(this,arguments)}return n}(),changePayType:function(t){this.payType=t,1==t&&(this.paycode="wxminipay"),3==t&&(this.paycode="pdpay")},stopPrevent:function(t){console.log("======stopPrevent====="),console.log(t)},selectcoupon:function(t){console.log("======selectcoupon====="),this.selectCouponId=t.voucher_id,this.discount_money=t.voucher_price,this.selectCouponTxt=t.mtitle,this.toggleMask()},confirm:function(){var o=r(e.default.mark(function o(){var n;return e.default.wrap(function(o){while(1)switch(o.prev=o.next){case 0:n=this,t.showModal({title:"提示",content:"是否确认支付当前订单",success:function(o){if(o.confirm)if("wxminipay"==n.paycode)t.login({provider:"weixin",success:function(t){var o=t.code;console.log(o),n.toPostPay(o)}});else{if(0!=n.memberInfo.pp_state)return void n.masks();t.showToast({icon:"none",title:"您未设置支付密码，请到个人中心—>安全设置里进行设置",duration:2e3,success:function(){setTimeout(function(){},2e3)}})}else o.cancel&&console.log("用户点击取消")}});case 2:case"end":return o.stop()}},o,this)}));function n(){return o.apply(this,arguments)}return n}(),toPostPay:function(o){var n=this;n.logining=!0;var e={store_id:this.store_id,total:this.inmoney,vt_id:this.selectCouponId,paycode:this.paycode,wxcode:o,ppwd:this.password};this.$Request.post("member_buy/buy_step2",e).then(function(o){200==o.code?(console.log(o),"wxminipay"==o.datas.payment_code?(console.log("调起支付"),t.requestPayment({provider:"wxpay",timeStamp:o.datas.payinfo.timeStamp+"",nonceStr:o.datas.payinfo.nonceStr+"",package:o.datas.payinfo.package+"",signType:o.datas.payinfo.signType+"",paySign:o.datas.payinfo.paySign+"",success:function(t){console.log("success:"+JSON.stringify(t))},fail:function(t){console.log("fail:"+JSON.stringify(t)),n.logining=!1}})):t.showToast({icon:"none",title:"支付成功",duration:2e3,success:function(){setTimeout(function(){t.navigateTo({url:"/pages/store/index?store_id="+n.store_id})},2e3)}})):(t.showToast({icon:"none",title:o.datas.error,duration:2e3}),n.logining=!1)})},nextPay:function(){var o=r(e.default.mark(function o(){var n;return e.default.wrap(function(o){while(1)switch(o.prev=o.next){case 0:if(n=this,!(this.inmoney.length<1)){o.next=4;break}return t.showToast({icon:"none",title:"请输入消费金额！",duration:2e3}),o.abrupt("return",!1);case 4:n.logining=!1,n.$Request.post("member_buy/buy_step1",{store_id:this.store_id,total:this.inmoney}).then(function(o){200==o.code?(console.log(o),n.memberInfo=o.datas.member_info,n.couponList=o.datas.voucher_list,n.inmoney=o.datas.cost_total,n.step=2):t.showToast({icon:"none",title:o.datas.error,duration:2e3})});case 6:case"end":return o.stop()}},o,this)}));function n(){return o.apply(this,arguments)}return n}(),toggleMask:function(t){var o=this,n="show"===t?10:300,e="show"===t?1:0;this.maskState=2,setTimeout(function(){o.maskState=e},n)},checkNum:function(t){var o=this;if(this.pwdnum<6&&(console.log("---"+t),this.passwordArray.push(t+""),this.pwdnum++,console.log(this.passwordArray)),6==this.pwdnum){for(var n="",e=0;e<this.passwordArray.length;e++)n+=this.passwordArray[e];console.log(n),this.password=n,this.mask=!1,this.passwordArray=[],this.bott="",console.log(this.password),o.toPostPay(""),this.pwdnum=0}},reset:function(){this.passwordArray=[],this.pwdnum=0},backspace:function(){this.passwordArray.pop(),this.pwdnum--},masks:function(){var t=this;this.mask=!0,this.pwdnum=0,setTimeout(function(){t.bott="bot"},50)},maskss:function(){this.mask=!1,this.bott="",this.passwordArray=[],this.pwdnum=0}}};o.default=c}).call(this,n("543d")["default"])},cdbc:function(t,o,n){"use strict";n.r(o);var e=n("c817"),s=n.n(e);for(var i in e)"default"!==i&&function(t){n.d(o,t,function(){return e[t]})}(i);o["default"]=s.a},e8ea:function(t,o,n){}},[["a18d","common/runtime","common/vendor"]]]);